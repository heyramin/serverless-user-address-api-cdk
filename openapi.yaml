openapi: 3.0.0
info:
  title: User Address API
  description: RESTful API for managing user addresses with CRUD operations
  version: 1.0.0
  contact:
    name: API Support
    email: heyramin@gmail.com

servers:
  - url: https://api.example.com/prod
    description: Production
  - url: https://api.example.com/dev
    description: Development
  - url: http://localhost:3000/dev
    description: Local Development

paths:
  /v1/users/{userId}/addresses:
    post:
      summary: Create a new address for a user
      operationId: createAddress
      parameters:
        - in: path
          name: userId
          required: true
          schema:
            type: string
            pattern: '^[a-zA-Z0-9_-]+$'
            minLength: 1
            maxLength: 128
          description: Unique user identifier (1-128 characters, alphanumeric, hyphens, underscores only)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AddressInput'
      responses:
        201:
          description: Address created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AddressResponse'
        400:
          description: Invalid input
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        401:
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    get:
      summary: Retrieve addresses for a user with optional filtering
      operationId: getAddresses
      parameters:
        - in: path
          name: userId
          required: true
          schema:
            type: string
            pattern: '^[a-zA-Z0-9_-]+$'
            minLength: 1
            maxLength: 128
          description: Unique user identifier (1-128 characters, alphanumeric, hyphens, underscores only)
        - in: query
          name: suburb
          schema:
            type: string
          description: Filter by suburb
        - in: query
          name: postcode
          schema:
            type: string
          description: Filter by postcode
      responses:
        200:
          description: Addresses retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AddressesListResponse'
        401:
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        404:
          description: User not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /v1/users/{userId}/addresses/{addressId}:
    patch:
      summary: Update an existing address
      operationId: updateAddress
      parameters:
        - in: path
          name: userId
          required: true
          schema:
            type: string
            pattern: '^[a-zA-Z0-9_-]+$'
            minLength: 1
            maxLength: 128
          description: Unique user identifier (1-128 characters, alphanumeric, hyphens, underscores only)
        - in: path
          name: addressId
          required: true
          schema:
            type: string
            format: uuid
          description: Unique address identifier (UUID format - supports v1, v3, v4, v5)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AddressUpdate'
      responses:
        200:
          description: Address updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AddressResponse'
        400:
          description: Invalid input
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        401:
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        404:
          description: Address not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    delete:
      summary: Delete an address
      operationId: deleteAddress
      parameters:
        - in: path
          name: userId
          required: true
          schema:
            type: string
            pattern: '^[a-zA-Z0-9_-]+$'
            minLength: 1
            maxLength: 128
          description: Unique user identifier (1-128 characters, alphanumeric, hyphens, underscores only)
        - in: path
          name: addressId
          required: true
          schema:
            type: string
            format: uuid
          description: Unique address identifier (UUID format - supports v1, v3, v4, v5)
      responses:
        204:
          description: Address deleted successfully
        401:
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        404:
          description: Address not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

components:
  schemas:
    Address:
      type: object
      properties:
        id:
          type: string
          format: uuid
          description: Unique address identifier (UUID format)
        userId:
          type: string
          pattern: '^[a-zA-Z0-9_-]+$'
          description: User ID associated with this address (alphanumeric, hyphens, underscores only)
        streetAddress:
          type: string
          pattern: '^[a-zA-Z0-9\s\-''.,#]+$'
          description: Street address line (supports numbers, letters, spaces, hyphens, apostrophes, periods, commas, and # symbols)
        suburb:
          type: string
          pattern: '^[a-zA-Z0-9\s\-''.]+$'
          description: Suburb or city name (letters, numbers, spaces, hyphens, apostrophes, periods)
        state:
          type: string
          enum: [NSW, VIC, QLD, WA, SA, TAS, ACT, NT]
          description: Australian state/territory code
        postcode:
          type: string
          pattern: '^\d{4}$'
          description: Australian postcode (4 digits)
        country:
          type: string
          default: Australia
          description: Country name
        addressType:
          type: string
          enum: [billing, mailing, residential, business]
          description: Type of address
        createdAt:
          type: string
          format: date-time
          description: ISO 8601 timestamp when address was created
        updatedAt:
          type: string
          format: date-time
          description: ISO 8601 timestamp when address was last updated
          type: string
          enum: [billing, mailing, residential, business]
          description: Type of address (billing, mailing, residential, or business)
        createdAt:
          type: string
          format: date-time
          description: ISO 8601 timestamp when address was created
        updatedAt:
          type: string
          format: date-time
          description: ISO 8601 timestamp when address was last updated

    AddressInput:
      type: object
      required:
        - streetAddress
        - suburb
        - state
        - postcode
      properties:
        streetAddress:
          type: string
          minLength: 1
          maxLength: 256
          pattern: '^[a-zA-Z0-9\s\-''.,#]+$'
          description: Street address line (supports numbers, letters, spaces, hyphens, apostrophes, periods, commas, and # symbols)
        suburb:
          type: string
          minLength: 1
          maxLength: 128
          pattern: '^[a-zA-Z0-9\s\-''.]+$'
          description: Suburb or city name (letters, numbers, spaces, hyphens, apostrophes, periods)
        state:
          type: string
          enum: [NSW, VIC, QLD, WA, SA, TAS, ACT, NT]
          description: Australian state/territory code
        postcode:
          type: string
          pattern: '^\d{4}$'
          description: Australian postcode (4 digits)
        country:
          type: string
          default: Australia
          minLength: 1
          maxLength: 128
          pattern: '^[a-zA-Z0-9\s\-'']+$'
          description: Country name
        addressType:
          type: string
          enum: [billing, mailing, residential, business]
          description: Type of address

    AddressUpdate:
      type: object
      properties:
        streetAddress:
          type: string
          minLength: 1
          maxLength: 256
          pattern: '^[a-zA-Z0-9\s\-''.,#]+$'
          description: Street address line
        suburb:
          type: string
          minLength: 1
          maxLength: 128
          pattern: '^[a-zA-Z0-9\s\-''.]+$'
          description: Suburb or city name
        state:
          type: string
          enum: [NSW, VIC, QLD, WA, SA, TAS, ACT, NT]
          description: Australian state/territory code
        postcode:
          type: string
          description: Postal code
        country:
          type: string
          description: Country name
        addressType:
          type: string
          enum: [billing, mailing, residential, business]
          description: Type of address (billing, mailing, residential, or business)

    AddressResponse:
      type: object
      properties:
        message:
          type: string
        address:
          $ref: '#/components/schemas/Address'
        addressId:
          type: string
          description: ID of the created/updated address

    AddressesListResponse:
      type: object
      properties:
        message:
          type: string
        addresses:
          type: array
          items:
            $ref: '#/components/schemas/Address'

    ErrorResponse:
      type: object
      properties:
        message:
          type: string
        error:
          type: string
        statusCode:
          type: integer

  securitySchemes:
    BasicAuth:
      type: http
      scheme: basic
      description: HTTP Basic Auth with SHA-256 hashed credentials

security:
  - BasicAuth: []
